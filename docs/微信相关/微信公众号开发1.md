---
title: 微信开发指南
date: 2020-08-15
tags:
- 微信
- 公众号
categories:
- 微信
---

#### 填写服务器的配置

1. 登录微信公众平台官网后，在公众平台官网的开发-基本设置页面，勾选协议成为开发者
2. 点击“修改配置”按钮，填写服务器地址（URL）、Token和EncodingAESKey，其中URL是开发者用来接收微信消息和事件的接口URL。
3. Token可由开发者可以任意填写，用作生成签名（该Token会和接口URL中包含的Token进行比对，从而验证安全性）。EncodingAESKey由开发者手动填写或随机生成，将用作消息体加解密密钥。

#### 来自微信服务器的消息验证

1. 开发者提信息后，微信服务器将发送get请求到填写的服务器地址url上

|参数|含义|
|---|----|
|signature|微信加密签名，signature结合了开发者填写的token参数和请求中的timestamp参数、nonce参数。|
|timestamp|时间戳|
|nonce|随机数|
|echostr|随机字符串|

2.成为开发者后，用户每次向公众号发送消息、或者产生自定义菜单、或产生微信支付订单等情况时，开发者填写的服务器配置URL将得到微信服务器推送过来的消息和事件，开发者可以依据自身业务逻辑进行响应，如回复消息。

3.微信公众号接口必须以<http://或https://开头，分别支持80端口和443>端口。

#### 自定义菜单

* 自定义菜单最多包括3个一级菜单，每个一级菜单最多包含5个二级菜单。
* 一级菜单最多4个汉字，二级菜单最多7个汉字，多出来的部分将会以“...”代替。
* 创建自定义菜单后，菜单的刷新策略是，在用户进入公众号会话页或公众号profile页时，如果发现上一次拉取菜单的请求在5分钟以前，就会拉取一下菜单，如果菜单有更新，就会刷新客户端的菜单。测试时可以尝试取消关注公众账号后再次关注，则可以看到创建后的效果。​

具体配置可以查看官方文档 [微信开放文档](https://developers.weixin.qq.com/doc/)

```json
 {
     "button":[
     {
          "type":"click",
          "name":"今日歌曲",
          "key":"V1001_TODAY_MUSIC"
      },
      {
           "name":"菜单",
           "sub_button":[
           {
               "type":"view",
               "name":"搜索",
               "url":"http://www.soso.com/"
            },
            {
                 "type":"miniprogram",
                 "name":"wxa",
                 "url":"http://mp.weixin.qq.com",
                 "appid":"wx286b93c14bbf93aa",
                 "pagepath":"pages/lunar/index"
             },
            {
               "type":"click",
               "name":"赞一下我们",
               "key":"V1001_GOOD"
            }]
       }]
 }
```

#### 微信公众号会话

公众号是以微信用户的一个联系人形式存在的，消息会话是公众号与用户交互的基础。目前公众号内主要有这样几类消息服务的类型

* 群发消息：服务号可以每月4次，形式如何会话聊天一样，订阅号每天可以发一次，向用户群发消息，包括文字消息、图文消息、图片、视频、语音等
* 被动回复消息：用户再给公众号发送消息后，微信服务器会将该消息发送到预先设置好的服务器地址，可以回复一个消息，也可以回复命令告诉微信服务器这条消息暂不回复。被动回复消息可以设置加密
* 客服消息：在用户给公众号发消息后的48小时内，公众号可以给用户发送不限数量的消息，主要用于客服场景。用户的行为会触发事件推送，某些事件推送是支持公众号据此发送客服消息的，详见微信推送消息与事件说明文档
* 模板消息：在需要对用户发送服务通知（如刷卡提醒、服务预约成功通知等）时，公众号可以用特定内容模板，主动向用户发送消息，比如一些商家的排号

#### 公众号内网页

和微信H5应用类似，需要调用微信js-sdk

* 网页授权获取用户基本信息：通过该接口，可以获取用户的基本信息（获取用户的OpenID是无需用户同意的，获取用户的基本信息则需用户同意)
* 微信JS-SDK：是开发者在网页上通过JavaScript代码使用微信原生功能的工具包，开发者可以使用它在网页上录制和播放微信语音、监听微信分享、上传手机本地图片、拍照等许多能力。
